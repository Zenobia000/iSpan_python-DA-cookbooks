# %% [markdown]
## ğŸ“˜ M2.4 Pandas ç¼ºå¤±å€¼è™•ç†åŸºç¤

æœ¬æ•™å­¸å°‡ä»‹ç´¹ Pandas ä¸­è™•ç†ç¼ºå¤±å€¼çš„åŸºæœ¬æ–¹æ³•ã€‚åœ¨å¯¦éš›æ•¸æ“šåˆ†æä¸­ï¼Œè™•ç†ç¼ºå¤±å€¼æ˜¯æ•¸æ“šæ¸…æ´—éç¨‹ä¸­çš„é‡è¦æ­¥é©Ÿï¼ŒæŒæ¡é€™äº›æŠ€å·§å¯ä»¥å¹«åŠ©æ‚¨æ›´æœ‰æ•ˆåœ°æº–å‚™æ•¸æ“šã€‚

# %% [markdown]
### ğŸ¯ æ•™å­¸ç›®æ¨™

- ğŸ” äº†è§£ Pandas ä¸­ç¼ºå¤±å€¼çš„è¡¨ç¤ºæ–¹å¼
- ğŸ“Š å­¸ç¿’æª¢æ¸¬å’Œè¨ˆç®—ç¼ºå¤±å€¼çš„æ–¹æ³•
- ğŸ§¹ æŒæ¡è™•ç†ç¼ºå¤±å€¼çš„åŸºæœ¬ç­–ç•¥ï¼ˆåˆªé™¤èˆ‡å¡«å……ï¼‰
- ğŸ’» ç·´ç¿’ç¼ºå¤±å€¼è™•ç†çš„åŸºæœ¬æŠ€å·§

# %%
### ğŸ§° ç’°å¢ƒè¨­ç½®

# %%
import numpy as np
import pandas as pd

# è¨­ç½®é¡¯ç¤ºé¸é …
pd.set_option('display.max_rows', 10)
pd.set_option('display.max_columns', 10)
pd.set_option('display.width', 80)
pd.set_option('display.precision', 3)

# %% [markdown]
### ğŸ“Š 1. ç¼ºå¤±å€¼çš„è¡¨ç¤ºèˆ‡å‰µå»º

Pandas ä½¿ç”¨ `NaN` (Not a Number) ä¾†è¡¨ç¤ºæ•¸å€¼å‹æ•¸æ“šçš„ç¼ºå¤±å€¼ï¼Œä½¿ç”¨ `None` è¡¨ç¤ºå…¶ä»–é¡å‹çš„ç¼ºå¤±å€¼ã€‚

# %%
# 1.1 å‰µå»ºå¸¶æœ‰ç¼ºå¤±å€¼çš„ DataFrame
df = pd.DataFrame({
    'A': [1, 2, np.nan, 4, 5],
    'B': [np.nan, 2, 3, 4, 5],
    'C': [1, 2, 3, np.nan, 5],
    'D': ['a', 'b', 'c', None, 'e']
})

print("å¸¶æœ‰ç¼ºå¤±å€¼çš„ DataFrame:")
print(df)

# %%
# 1.2 äº†è§£ NaN å’Œ None çš„å€åˆ¥
print("NaN æ˜¯æµ®é»å‹å—?", np.issubdtype(type(np.nan), np.floating))
print("None çš„é¡å‹:", type(None))
print("\nä½¿ç”¨ np.nan å»ºç«‹çš„åˆ—çš„æ•¸æ“šé¡å‹:", df['A'].dtype)
print("ä½¿ç”¨ None å»ºç«‹çš„åˆ—çš„æ•¸æ“šé¡å‹:", df['D'].dtype)

# %%
# è§£èªª:
# - Pandas ä½¿ç”¨æµ®é»å‹çš„ NaN è¡¨ç¤ºæ•¸å€¼å‹ç¼ºå¤±å€¼
# - None è¡¨ç¤ºéæ•¸å€¼å‹æ•¸æ“šçš„ç¼ºå¤±
# - ç•¶åˆ—ä¸­å«æœ‰ NaN æ™‚ï¼Œæ•¸å€¼åˆ—æœƒè¢«è½‰æ›ç‚ºæµ®é»å‹
# - ç•¶åˆ—ä¸­å«æœ‰ None æ™‚ï¼Œå­—ç¬¦ä¸²åˆ—æœƒä¿æŒåŸæ•¸æ“šé¡å‹
# - åœ¨å¤§å¤šæ•¸æƒ…æ³ä¸‹ï¼ŒPandas æœƒå°‡ None åœ¨å…§éƒ¨è½‰æ›ç‚º NaN é€²è¡Œè™•ç†

# %% [markdown]
### ğŸ“Š 2. æª¢æ¸¬ç¼ºå¤±å€¼

# %%
# 2.1 æª¢æ¸¬ç¼ºå¤±å€¼
is_na = df.isna()  # ä¹Ÿå¯ä»¥ä½¿ç”¨ df.isnull()
print("ç¼ºå¤±å€¼æª¢æ¸¬ (True è¡¨ç¤ºç¼ºå¤±):")
print(is_na)

# 2.2 æª¢æ¸¬éç¼ºå¤±å€¼
is_not_na = df.notna()  # ä¹Ÿå¯ä»¥ä½¿ç”¨ df.notnull()
print("\néç¼ºå¤±å€¼æª¢æ¸¬ (True è¡¨ç¤ºéç¼ºå¤±):")
print(is_not_na)

# %%
# 2.3 è¨ˆç®—æ¯åˆ—çš„ç¼ºå¤±å€¼æ•¸é‡
na_count_by_column = df.isna().sum()
print("æ¯åˆ—çš„ç¼ºå¤±å€¼æ•¸é‡:")
print(na_count_by_column)

# 2.4 è¨ˆç®—æ¯è¡Œçš„ç¼ºå¤±å€¼æ•¸é‡
na_count_by_row = df.isna().sum(axis=1)
print("\næ¯è¡Œçš„ç¼ºå¤±å€¼æ•¸é‡:")
print(na_count_by_row)

# 2.5 è¨ˆç®—ç¼ºå¤±å€¼çš„ç™¾åˆ†æ¯”
na_percentage = df.isna().mean() * 100
print("\næ¯åˆ—ç¼ºå¤±å€¼çš„ç™¾åˆ†æ¯”:")
print(na_percentage)

# %%
# è§£èªª:
# - `isna()` å’Œ `isnull()` éƒ½ç”¨æ–¼æª¢æ¸¬ç¼ºå¤±å€¼ï¼Œè¿”å›å¸ƒçˆ¾å€¼çŸ©é™£
# - `notna()` å’Œ `notnull()` ç”¨æ–¼æª¢æ¸¬éç¼ºå¤±å€¼ï¼Œèˆ‡ `isna()` ç›¸å
# - ä½¿ç”¨ `sum()` å¯ä»¥è¨ˆç®—ç¼ºå¤±å€¼çš„æ•¸é‡ï¼Œåƒæ•¸ `axis=1` è¡¨ç¤ºæŒ‰è¡Œè¨ˆç®—
# - ä½¿ç”¨ `mean()` å¯ä»¥è¨ˆç®—ç¼ºå¤±å€¼çš„æ¯”ä¾‹ï¼Œä¹˜ä»¥ 100 è½‰æ›ç‚ºç™¾åˆ†æ¯”
# - é€™äº›æ–¹æ³•å¯ä»¥å¹«åŠ©æˆ‘å€‘äº†è§£æ•¸æ“šé›†ä¸­ç¼ºå¤±å€¼çš„åˆ†å¸ƒæƒ…æ³

# %% [markdown]
### ğŸ“Š 3. åˆªé™¤ç¼ºå¤±å€¼

# %%
# 3.1 åˆªé™¤å«æœ‰ç¼ºå¤±å€¼çš„è¡Œ
df_dropna_rows = df.dropna()
print("åˆªé™¤æ‰€æœ‰å«æœ‰ç¼ºå¤±å€¼çš„è¡Œ:")
print(df_dropna_rows)

# 3.2 åˆªé™¤æ‰€æœ‰å€¼éƒ½æ˜¯ç¼ºå¤±å€¼çš„è¡Œ
df_dropna_all = df.dropna(how='all')
print("\nåˆªé™¤æ‰€æœ‰å€¼éƒ½æ˜¯ç¼ºå¤±å€¼çš„è¡Œ:")
print(df_dropna_all)

# 3.3 åˆªé™¤å«æœ‰ç¼ºå¤±å€¼çš„åˆ—
df_dropna_columns = df.dropna(axis=1)
print("\nåˆªé™¤æ‰€æœ‰å«æœ‰ç¼ºå¤±å€¼çš„åˆ—:")
print(df_dropna_columns)

# %%
# 3.4 æ ¹æ“šé–¾å€¼åˆªé™¤ç¼ºå¤±å€¼
# åªä¿ç•™è‡³å°‘æœ‰ 3 å€‹éç¼ºå¤±å€¼çš„è¡Œ
df_thresh = df.dropna(thresh=3)
print("ä¿ç•™è‡³å°‘æœ‰ 3 å€‹éç¼ºå¤±å€¼çš„è¡Œ:")
print(df_thresh)

# 3.5 åŸºæ–¼ç‰¹å®šåˆ—åˆªé™¤ç¼ºå¤±å€¼
df_subset = df.dropna(subset=['A', 'B'])
print("\nåˆªé™¤ A æˆ– B åˆ—æœ‰ç¼ºå¤±å€¼çš„è¡Œ:")
print(df_subset)

# %%
# è§£èªª:
# - `dropna()` ç”¨æ–¼åˆªé™¤å«æœ‰ç¼ºå¤±å€¼çš„è¡Œæˆ–åˆ—
# - é»˜èªæƒ…æ³ä¸‹ï¼Œ`dropna()` åˆªé™¤ä»»ä½•åŒ…å«ç¼ºå¤±å€¼çš„è¡Œ
# - åƒæ•¸ `how='all'` è¡¨ç¤ºåƒ…ç•¶æ‰€æœ‰å€¼éƒ½æ˜¯ç¼ºå¤±å€¼æ™‚æ‰åˆªé™¤
# - åƒæ•¸ `axis=1` è¡¨ç¤ºåˆªé™¤åˆ—è€Œä¸æ˜¯è¡Œ
# - åƒæ•¸ `thresh` æŒ‡å®šä¿ç•™è¡Œ/åˆ—æ‰€éœ€çš„éç¼ºå¤±å€¼æœ€å°æ•¸é‡
# - åƒæ•¸ `subset` æŒ‡å®šåƒ…è€ƒæ…®ç‰¹å®šåˆ—çš„ç¼ºå¤±å€¼
# - é€™äº›æ–¹æ³•é»˜èªè¿”å›æ–°çš„ DataFrameï¼Œä¸ä¿®æ”¹åŸå§‹æ•¸æ“š

# %% [markdown]
### ğŸ“Š 4. å¡«å……ç¼ºå¤±å€¼

# %%
# 4.1 ç”¨å›ºå®šå€¼å¡«å……ç¼ºå¤±å€¼
df_fill_0 = df.fillna(0)
print("ç”¨ 0 å¡«å……æ‰€æœ‰ç¼ºå¤±å€¼:")
print(df_fill_0)

# 4.2 é‡å°ä¸åŒåˆ—ä½¿ç”¨ä¸åŒçš„å¡«å……å€¼
fill_values = {'A': 0, 'B': 999, 'C': df['C'].mean(), 'D': 'missing'}
df_fill_dict = df.fillna(fill_values)
print("\nä½¿ç”¨å­—å…¸æŒ‡å®šä¸åŒåˆ—çš„å¡«å……å€¼:")
print(df_fill_dict)

# %%
# 4.3 ä½¿ç”¨å‰å‘å¡«å…… (Forward Fill)
df_ffill = df.fillna(method='ffill')
print("ä½¿ç”¨å‰å‘å¡«å…… (ç”¨å‰ä¸€å€‹æœ‰æ•ˆå€¼å¡«å……):")
print(df_ffill)

# 4.4 ä½¿ç”¨å¾Œå‘å¡«å…… (Backward Fill)
df_bfill = df.fillna(method='bfill')
print("\nä½¿ç”¨å¾Œå‘å¡«å…… (ç”¨å¾Œä¸€å€‹æœ‰æ•ˆå€¼å¡«å……):")
print(df_bfill)

# 4.5 é™åˆ¶å¡«å……çš„é€£çºŒç¼ºå¤±å€¼æ•¸é‡
df_ffill_limit = df.fillna(method='ffill', limit=1)
print("\né™åˆ¶å‰å‘å¡«å……æœ€å¤šå¡«å……é€£çºŒ 1 å€‹ç¼ºå¤±å€¼:")
print(df_ffill_limit)

# %%
# è§£èªª:
# - `fillna()` ç”¨æ–¼å¡«å……ç¼ºå¤±å€¼
# - å¯ä»¥ä½¿ç”¨å›ºå®šå€¼å¡«å……æ‰€æœ‰ç¼ºå¤±å€¼
# - å¯ä»¥ä½¿ç”¨å­—å…¸ç‚ºä¸åŒåˆ—æŒ‡å®šä¸åŒçš„å¡«å……å€¼
# - `method='ffill'` (æˆ– `pad`) è¡¨ç¤ºä½¿ç”¨å‰ä¸€å€‹æœ‰æ•ˆå€¼å¡«å……
# - `method='bfill'` (æˆ– `backfill`) è¡¨ç¤ºä½¿ç”¨å¾Œä¸€å€‹æœ‰æ•ˆå€¼å¡«å……
# - åƒæ•¸ `limit` å¯ä»¥é™åˆ¶é€£çºŒå¡«å……çš„ç¼ºå¤±å€¼æ•¸é‡
# - é€™äº›æ–¹æ³•é»˜èªè¿”å›æ–°çš„ DataFrameï¼Œä¸ä¿®æ”¹åŸå§‹æ•¸æ“š

# %% [markdown]
### ğŸ“Š 5. æ’å€¼æ³•å¡«å……ç¼ºå¤±å€¼

# %%
# 5.1 å‰µå»ºä¸€å€‹æœ‰æ•¸å€¼ç¼ºå¤±çš„ç¤ºä¾‹
ts = pd.Series([1, np.nan, np.nan, 4, 5, np.nan, 7])
print("åŸå§‹æ•¸å€¼åºåˆ—:")
print(ts)

# 5.2 ç·šæ€§æ’å€¼
ts_interp = ts.interpolate()
print("\nç·šæ€§æ’å€¼å¾Œ:")
print(ts_interp)

# 5.3 ä½¿ç”¨å…¶ä»–æ’å€¼æ–¹æ³•
ts_interp_quad = ts.interpolate(method='quadratic')
print("\näºŒæ¬¡æ’å€¼å¾Œ:")
print(ts_interp_quad)

# %%
# è§£èªª:
# - `interpolate()` ç”¨æ–¼ä½¿ç”¨æ’å€¼æ³•å¡«å……ç¼ºå¤±å€¼
# - é»˜èªä½¿ç”¨ç·šæ€§æ’å€¼ï¼Œå‡è¨­ç›¸é„°é»ä¹‹é–“æœ‰ç·šæ€§é—œä¿‚
# - ä¹Ÿæ”¯æŒå…¶ä»–æ’å€¼æ–¹æ³•ï¼Œå¦‚äºŒæ¬¡æ’å€¼ (`quadratic`)
# - æ’å€¼æ³•ä¸»è¦é©ç”¨æ–¼æ•¸å€¼å‹æ•¸æ“šï¼Œç‰¹åˆ¥æ˜¯æ™‚é–“åºåˆ—æ•¸æ“š
# - å°æ–¼æœ‰æ˜é¡¯è¶¨å‹¢æˆ–è¦å¾‹çš„æ•¸æ“šï¼Œæ’å€¼æ³•é€šå¸¸æ¯”ç°¡å–®å¡«å……æ›´åˆç†
# - æ’å€¼æ³•éœ€è¦è¶³å¤ çš„éç¼ºå¤±å€¼é»ä½œç‚ºåƒè€ƒ

# %% [markdown]
### ğŸ“Š 6. å¯¦éš›æ¡ˆä¾‹ï¼šå­¸ç”Ÿæˆç¸¾æ•¸æ“š

# %%
# 6.1 å‰µå»ºå­¸ç”Ÿæˆç¸¾æ•¸æ“šé›†
students = pd.DataFrame({
    'Name': ['Alice', 'Bob', 'Charlie', 'David', 'Eva', 'Frank', 'Grace'],
    'Math': [85, 90, np.nan, 75, 60, np.nan, 95],
    'Science': [90, np.nan, 80, 70, np.nan, 85, 100],
    'English': [np.nan, 85, 90, 80, 70, 75, np.nan],
    'History': [80, 75, 85, np.nan, 90, 80, 85]
})

print("å­¸ç”Ÿæˆç¸¾æ•¸æ“š (å«ç¼ºå¤±å€¼):")
print(students)

# %%
# 6.2 æª¢æŸ¥ç¼ºå¤±å€¼æƒ…æ³
print("æ¯é–€èª²ç¨‹çš„ç¼ºå¤±æˆç¸¾æ•¸é‡:")
print(students.isna().sum())
print("\næ¯å€‹å­¸ç”Ÿçš„ç¼ºå¤±æˆç¸¾æ•¸é‡:")
print(students.isna().sum(axis=1))

# 6.3 ä½¿ç”¨å¹³å‡å€¼å¡«å……ç¼ºå¤±çš„æˆç¸¾
students_filled = students.copy()
for column in ['Math', 'Science', 'English', 'History']:
    students_filled[column] = students_filled[column].fillna(students[column].mean())
    
print("\nä½¿ç”¨èª²ç¨‹å¹³å‡åˆ†å¡«å……å¾Œçš„æˆç¸¾:")
print(students_filled)

# 6.4 æ‰¾å‡ºå®Œæˆæ‰€æœ‰ç§‘ç›®çš„å­¸ç”Ÿ
complete_students = students.dropna()
print("\nå®Œæˆæ‰€æœ‰ç§‘ç›®çš„å­¸ç”Ÿ:")
print(complete_students)

# %%
# è§£èªª:
# - åœ¨å¯¦éš›æ‡‰ç”¨ä¸­ï¼Œç¼ºå¤±å€¼è™•ç†ç­–ç•¥å–æ±ºæ–¼æ•¸æ“šçš„æ€§è³ªå’Œåˆ†æç›®çš„
# - å°æ–¼æˆç¸¾æ•¸æ“šï¼Œä½¿ç”¨ç§‘ç›®å¹³å‡åˆ†å¡«å……æ˜¯å¸¸è¦‹çš„åšæ³•
# - è¨ˆç®—æ¯å€‹å­¸ç”Ÿçš„ç¼ºå¤±ç§‘ç›®æ•¸é‡å¯ä»¥å¹«åŠ©è­˜åˆ¥æ•¸æ“šå®Œæ•´æ€§å•é¡Œ
# - æ ¹æ“šåˆ†æç›®çš„ï¼Œå¯èƒ½éœ€è¦åˆªé™¤ç¼ºå¤±å€¼éå¤šçš„è¨˜éŒ„
# - è™•ç†ç¼ºå¤±å€¼æ˜¯æ•¸æ“šé è™•ç†çš„é‡è¦æ­¥é©Ÿï¼Œç›´æ¥å½±éŸ¿åˆ†æçµæœçš„å¯é æ€§

# %% [markdown]
### ğŸ“‹ 7. ç¸½çµ

# %% [markdown]
#### 7.1 ç¼ºå¤±å€¼è™•ç†çš„ä¸»è¦æ–¹æ³•

- **æª¢æ¸¬ç¼ºå¤±å€¼**:
  - `isna()` / `isnull()`: æª¢æ¸¬ç¼ºå¤±å€¼
  - `notna()` / `notnull()`: æª¢æ¸¬éç¼ºå¤±å€¼
  - `.sum()`, `.mean()`: è¨ˆç®—ç¼ºå¤±å€¼æ•¸é‡å’Œæ¯”ä¾‹

- **åˆªé™¤ç¼ºå¤±å€¼**:
  - `dropna()`: åˆªé™¤å«æœ‰ç¼ºå¤±å€¼çš„è¡Œæˆ–åˆ—
  - åƒæ•¸: `how`, `axis`, `thresh`, `subset`

- **å¡«å……ç¼ºå¤±å€¼**:
  - `fillna()`: ä½¿ç”¨æŒ‡å®šå€¼æˆ–æ–¹æ³•å¡«å……ç¼ºå¤±å€¼
  - å¡«å……ç­–ç•¥: å›ºå®šå€¼ã€å­—å…¸æŒ‡å®šå€¼ã€å‰å‘å¡«å……ã€å¾Œå‘å¡«å……
  - `interpolate()`: ä½¿ç”¨æ’å€¼æ³•å¡«å……æ•¸å€¼å‹ç¼ºå¤±å€¼

# %% [markdown]
#### 7.2 ç¼ºå¤±å€¼è™•ç†çš„æ³¨æ„äº‹é …

- åœ¨åˆªé™¤ç¼ºå¤±å€¼å‰å…ˆäº†è§£ç¼ºå¤±çš„æ¨¡å¼å’ŒåŸå› 
- é¸æ“‡åˆé©çš„å¡«å……æ–¹æ³•ï¼Œé¿å…å¼•å…¥åå·®
- è€ƒæ…®ç¼ºå¤±å€¼æ˜¯å¦ä»£è¡¨æœ‰æ„ç¾©çš„ä¿¡æ¯
- è™•ç†ç¼ºå¤±å€¼å‰å¾Œå°æ¯”æ•¸æ“šçµ±è¨ˆç‰¹æ€§ï¼Œç¢ºä¿ä¸€è‡´æ€§
- æ ¹æ“šç¼ºå¤±å€¼çš„æ¯”ä¾‹å’Œåˆ†å¸ƒé¸æ“‡æœ€åˆé©çš„ç­–ç•¥

# %% [markdown]
#### 7.3 ä¸‹ä¸€æ­¥å­¸ç¿’

- æ¢ç´¢æ›´å¤šç¼ºå¤±å€¼å¤„ç†æŠ€å·§
- å­¸ç¿’æ•¸æ“šé¡å‹è½‰æ›èˆ‡è™•ç†
- äº†è§£é‡è¤‡å€¼æª¢æ¸¬èˆ‡è™•ç†
- å­¸ç¿’æ•¸æ“šæ¸…æ´—çš„å®Œæ•´æµç¨‹
- æŒæ¡æ•¸æ“šé è™•ç†çš„æœ€ä½³å¯¦è¸ 