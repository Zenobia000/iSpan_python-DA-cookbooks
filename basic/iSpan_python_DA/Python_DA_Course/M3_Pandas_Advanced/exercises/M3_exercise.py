# %% [markdown]
# # ğŸ“˜ M3 Pandas é€²éšæ‡‰ç”¨ - ç·´ç¿’é¡Œ
# 
# æœ¬ç·´ç¿’å°‡å¹«åŠ©æ‚¨éå›º Pandas é€²éšæ¨¡çµ„ä¸­å­¸åˆ°çš„çŸ¥è­˜ï¼ŒåŒ…æ‹¬æ¢ä»¶ç¯©é¸ã€åˆ†çµ„èšåˆã€æ¨ç´è¡¨èˆ‡äº¤å‰è¡¨ã€æ•¸æ“šåˆä½µä»¥åŠæ™‚é–“åºåˆ—åˆ†æç­‰æŠ€è¡“ã€‚

# %% [markdown]
# ## ğŸ§° ç’°å¢ƒè¨­ç½®

# %%
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# è¨­ç½®é¡¯ç¤ºé¸é …
pd.set_option('display.max_rows', 15)
pd.set_option('display.max_columns', 12)
pd.set_option('display.width', 100)
pd.set_option('display.precision', 2)

# è¨­ç½®éš¨æ©Ÿç¨®å­ç¢ºä¿çµæœå¯é‡ç¾
np.random.seed(42)

# %% [markdown]
# ## ğŸ“Š ç·´ç¿’è³‡æ–™æº–å‚™
# 
# æˆ‘å€‘å°‡ä½¿ç”¨ä¸€å€‹æ¨¡æ“¬çš„é›»å­å•†å‹™æ•¸æ“šé›†é€²è¡Œç·´ç¿’ã€‚

# %%
# å‰µå»ºæ—¥æœŸç¯„åœ
dates = pd.date_range(start='2022-01-01', end='2022-12-31', freq='D')

# å‰µå»ºè¨‚å–®æ•¸æ“š
n_orders = 5000
order_data = {
    'order_id': np.arange(1, n_orders + 1),
    'order_date': np.random.choice(dates, n_orders),
    'customer_id': np.random.randint(1, 501, n_orders),
    'product_id': np.random.randint(1, 101, n_orders),
    'quantity': np.random.randint(1, 10, n_orders),
    'unit_price': np.random.uniform(10, 1000, n_orders).round(2),
    'payment_method': np.random.choice(['Credit Card', 'PayPal', 'Bank Transfer', 'Cash'], n_orders),
    'shipping_method': np.random.choice(['Standard', 'Express', 'Next Day'], n_orders, p=[0.7, 0.2, 0.1]),
    'order_status': np.random.choice(['Completed', 'Shipped', 'Processing', 'Cancelled'], n_orders, p=[0.8, 0.1, 0.05, 0.05])
}

# å‰µå»ºè¨‚å–® DataFrame
orders_df = pd.DataFrame(order_data)

# è¨ˆç®—è¨‚å–®ç¸½é‡‘é¡
orders_df['total_amount'] = orders_df['quantity'] * orders_df['unit_price']

# å‰µå»ºå®¢æˆ¶æ•¸æ“š
n_customers = 500
customer_data = {
    'customer_id': np.arange(1, n_customers + 1),
    'customer_name': [f'Customer_{i}' for i in range(1, n_customers + 1)],
    'customer_segment': np.random.choice(['Retail', 'Wholesale', 'Online'], n_customers, p=[0.6, 0.3, 0.1]),
    'country': np.random.choice(['USA', 'Canada', 'UK', 'Germany', 'France', 'Australia', 'Japan'], n_customers),
    'join_date': pd.date_range(start='2020-01-01', periods=n_customers)
}

# å‰µå»ºå®¢æˆ¶ DataFrame
customers_df = pd.DataFrame(customer_data)

# å‰µå»ºç”¢å“æ•¸æ“š
n_products = 100
product_data = {
    'product_id': np.arange(1, n_products + 1),
    'product_name': [f'Product_{i}' for i in range(1, n_products + 1)],
    'category': np.random.choice(['Electronics', 'Clothing', 'Home', 'Books', 'Sports'], n_products),
    'supplier_id': np.random.randint(1, 21, n_products),
    'stock_quantity': np.random.randint(0, 1000, n_products)
}

# å‰µå»ºç”¢å“ DataFrame
products_df = pd.DataFrame(product_data)

# é¡¯ç¤ºæ•¸æ“šé è¦½
print("è¨‚å–®æ•¸æ“šé è¦½:")
print(orders_df.head())
print("\nå®¢æˆ¶æ•¸æ“šé è¦½:")
print(customers_df.head())
print("\nç”¢å“æ•¸æ“šé è¦½:")
print(products_df.head())

# %% [markdown]
# ## ğŸ” ç·´ç¿’ 1: é€²éšæ¢ä»¶ç¯©é¸
# 
# ä½¿ç”¨ M3.1 ä¸­å­¸åˆ°çš„é€²éšæ¢ä»¶ç¯©é¸æŠ€è¡“å®Œæˆä»¥ä¸‹ä»»å‹™ã€‚

# %% [markdown]
# ### 1.1 ä½¿ç”¨è¤‡é›œæ¢ä»¶çµ„åˆ
# 
# ç¯©é¸å‡ºç¬¦åˆä»¥ä¸‹æ¢ä»¶çš„è¨‚å–®:
# - è¨‚å–®é‡‘é¡å¤§æ–¼ 500 æˆ–æ•¸é‡å¤§æ–¼ 5
# - æ”¯ä»˜æ–¹å¼ç‚º "Credit Card" æˆ– "PayPal"
# - è¨‚å–®ç‹€æ…‹ä¸æ˜¯ "Cancelled"

# %%
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ä»£ç¢¼
filtered_orders = None  # æ›¿æ›ç‚ºæ‚¨çš„ç¯©é¸ä»£ç¢¼

# é¡¯ç¤ºçµæœ
print(f"ç¬¦åˆæ¢ä»¶çš„è¨‚å–®æ•¸é‡: {len(filtered_orders)}")
print(filtered_orders.head())

# %% [markdown]
# ### 1.2 ä½¿ç”¨ query() æ–¹æ³•
# 
# ä½¿ç”¨ query() æ–¹æ³•ç¯©é¸å‡º:
# - 2022å¹´ç¬¬ä¸€å­£åº¦ (1-3æœˆ)
# - "Electronics" é¡åˆ¥çš„ç”¢å“
# - è¨‚å–®é‡‘é¡å¤§æ–¼ 1000
# 
# æç¤º: æ‚¨éœ€è¦å…ˆåˆä½µè¨‚å–®å’Œç”¢å“æ•¸æ“šã€‚

# %%
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ä»£ç¢¼
# 1. åˆä½µè¨‚å–®å’Œç”¢å“æ•¸æ“š
merged_data = None  # æ›¿æ›ç‚ºæ‚¨çš„åˆä½µä»£ç¢¼

# 2. ä½¿ç”¨ query() é€²è¡Œç¯©é¸
q1_electronics = None  # æ›¿æ›ç‚ºæ‚¨çš„ç¯©é¸ä»£ç¢¼

# é¡¯ç¤ºçµæœ
print(f"ç¬¦åˆæ¢ä»¶çš„è¨‚å–®æ•¸é‡: {len(q1_electronics)}")
print(q1_electronics.head())

# %% [markdown]
# ### 1.3 ä½¿ç”¨å­—ç¬¦ä¸²æ–¹æ³•å’Œæ­£å‰‡è¡¨é”å¼
# 
# æ‰¾å‡ºå®¢æˆ¶åç¨±ä¸­åŒ…å«æ•¸å­— "5" çš„å®¢æˆ¶ï¼Œä¸¦é¡¯ç¤ºä»–å€‘çš„è¨‚å–®ç¸½æ•¸å’Œç¸½é‡‘é¡ã€‚

# %%
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ä»£ç¢¼
customers_with_5 = None  # æ›¿æ›ç‚ºæ‚¨çš„ç¯©é¸ä»£ç¢¼

# åˆä½µå®¢æˆ¶å’Œè¨‚å–®æ•¸æ“š
customer_orders = None  # æ›¿æ›ç‚ºæ‚¨çš„åˆä½µå’Œèšåˆä»£ç¢¼

# é¡¯ç¤ºçµæœ
print(f"åç¨±ä¸­åŒ…å«æ•¸å­—5çš„å®¢æˆ¶æ•¸é‡: {len(customers_with_5)}")
print(customer_orders.head())

# %% [markdown]
# ## ğŸ”„ ç·´ç¿’ 2: åˆ†çµ„èˆ‡èšåˆé€²éšæ‡‰ç”¨
# 
# ä½¿ç”¨ M3.2 ä¸­å­¸åˆ°çš„åˆ†çµ„èˆ‡èšåˆæŠ€è¡“å®Œæˆä»¥ä¸‹ä»»å‹™ã€‚

# %% [markdown]
# ### 2.1 å¤šç¨®èšåˆå‡½æ•¸çµ„åˆ
# 
# æŒ‰ç”¢å“é¡åˆ¥åˆ†çµ„ï¼Œè¨ˆç®—ä»¥ä¸‹æŒ‡æ¨™:
# - è¨‚å–®ç¸½æ•¸
# - ç¸½éŠ·å”®é‡‘é¡
# - å¹³å‡è¨‚å–®é‡‘é¡
# - æœ€å¤§å’Œæœ€å°è¨‚å–®é‡‘é¡
# - è¨‚å–®é‡‘é¡çš„æ¨™æº–å·®

# %%
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ä»£ç¢¼
# åˆä½µè¨‚å–®å’Œç”¢å“æ•¸æ“š
merged_data = None  # æ›¿æ›ç‚ºæ‚¨çš„åˆä½µä»£ç¢¼

# æŒ‰é¡åˆ¥åˆ†çµ„ä¸¦è¨ˆç®—å¤šç¨®èšåˆæŒ‡æ¨™
category_stats = None  # æ›¿æ›ç‚ºæ‚¨çš„åˆ†çµ„èšåˆä»£ç¢¼

# é¡¯ç¤ºçµæœ
print(category_stats)

# %% [markdown]
# ### 2.2 ä½¿ç”¨ transform é€²è¡Œçµ„å…§æ¨™æº–åŒ–
# 
# å°æ¯å€‹ç”¢å“é¡åˆ¥å…§çš„è¨‚å–®é‡‘é¡é€²è¡Œæ¨™æº–åŒ–ï¼Œè¨ˆç®—:
# - æ¯ç­†è¨‚å–®é‡‘é¡èˆ‡è©²é¡åˆ¥å¹³å‡è¨‚å–®é‡‘é¡çš„å·®ç•°ç™¾åˆ†æ¯”
# - æ¯ç­†è¨‚å–®é‡‘é¡åœ¨è©²é¡åˆ¥ä¸­çš„ç™¾åˆ†ä½æ•¸

# %%
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ä»£ç¢¼
# åˆä½µè¨‚å–®å’Œç”¢å“æ•¸æ“š
merged_data = None  # æ›¿æ›ç‚ºæ‚¨çš„åˆä½µä»£ç¢¼

# ä½¿ç”¨ transform é€²è¡Œçµ„å…§æ¨™æº–åŒ–
merged_data['category_avg'] = None  # æ›¿æ›ç‚ºæ‚¨çš„ transform ä»£ç¢¼
merged_data['diff_from_avg_pct'] = None  # æ›¿æ›ç‚ºæ‚¨çš„è¨ˆç®—ä»£ç¢¼

# è¨ˆç®—çµ„å…§ç™¾åˆ†ä½æ•¸
merged_data['category_percentile'] = None  # æ›¿æ›ç‚ºæ‚¨çš„ç™¾åˆ†ä½æ•¸è¨ˆç®—ä»£ç¢¼

# é¡¯ç¤ºçµæœ
print(merged_data[['category', 'total_amount', 'category_avg', 'diff_from_avg_pct', 'category_percentile']].head(10))

# %% [markdown]
# ### 2.3 ä½¿ç”¨ apply é€²è¡Œè¤‡é›œçš„çµ„å…§æ“ä½œ
# 
# å°æ¯å€‹å®¢æˆ¶ï¼Œæ‰¾å‡ºä»–å€‘è³¼è²·é‡‘é¡æœ€é«˜çš„å‰3å€‹è¨‚å–®ï¼Œä¸¦è¨ˆç®—é€™äº›è¨‚å–®ä½”è©²å®¢æˆ¶ç¸½æ¶ˆè²»çš„ç™¾åˆ†æ¯”ã€‚

# %%
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ä»£ç¢¼
# å®šç¾©ä¸€å€‹å‡½æ•¸ä¾†æ‰¾å‡ºæ¯å€‹å®¢æˆ¶çš„å‰3å€‹è¨‚å–®
def top_orders(group):
    # åœ¨æ­¤ç·¨å¯«æ‚¨çš„å‡½æ•¸å…§å®¹
    pass

# æ‡‰ç”¨å‡½æ•¸åˆ°æ¯å€‹å®¢æˆ¶çµ„
top_customer_orders = None  # æ›¿æ›ç‚ºæ‚¨çš„ apply ä»£ç¢¼

# é¡¯ç¤ºçµæœ
print(top_customer_orders.head(10))

# %% [markdown]
# ## ğŸ“Š ç·´ç¿’ 3: æ¨ç´è¡¨èˆ‡äº¤å‰è¡¨
# 
# ä½¿ç”¨ M3.3 ä¸­å­¸åˆ°çš„æ¨ç´è¡¨èˆ‡äº¤å‰è¡¨æŠ€è¡“å®Œæˆä»¥ä¸‹ä»»å‹™ã€‚

# %% [markdown]
# ### 3.1 å‰µå»ºå¤šå±¤æ¬¡æ¨ç´è¡¨
# 
# å‰µå»ºä¸€å€‹æ¨ç´è¡¨ï¼Œé¡¯ç¤º:
# - è¡Œ: ç”¢å“é¡åˆ¥å’Œæ”¯ä»˜æ–¹å¼
# - åˆ—: è¨‚å–®æœˆä»½å’Œè¨‚å–®ç‹€æ…‹
# - å€¼: è¨‚å–®ç¸½é‡‘é¡(ç¸½å’Œ)å’Œè¨‚å–®æ•¸é‡(è¨ˆæ•¸)

# %%
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ä»£ç¢¼
# æº–å‚™æ•¸æ“š
merged_data = None  # æ›¿æ›ç‚ºæ‚¨çš„åˆä½µä»£ç¢¼
merged_data['order_month'] = None  # æå–è¨‚å–®æœˆä»½

# å‰µå»ºå¤šå±¤æ¬¡æ¨ç´è¡¨
pivot_table = None  # æ›¿æ›ç‚ºæ‚¨çš„æ¨ç´è¡¨ä»£ç¢¼

# é¡¯ç¤ºçµæœ
print(pivot_table.head())

# %% [markdown]
# ### 3.2 ä½¿ç”¨äº¤å‰è¡¨åˆ†æé¡åˆ¥é—œä¿‚
# 
# å‰µå»ºä¸€å€‹äº¤å‰è¡¨ï¼Œåˆ†æ:
# - ä¸åŒç”¢å“é¡åˆ¥åœ¨ä¸åŒåœ‹å®¶çš„éŠ·å”®åˆ†å¸ƒ
# - è¨ˆç®—æ¯å€‹é¡åˆ¥åœ¨æ¯å€‹åœ‹å®¶çš„éŠ·å”®ä½”æ¯” (normalize)
# - æ·»åŠ é‚Šéš›ç¸½è¨ˆ

# %%
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ä»£ç¢¼
# æº–å‚™æ•¸æ“š
merged_data = None  # æ›¿æ›ç‚ºæ‚¨çš„åˆä½µä»£ç¢¼

# å‰µå»ºäº¤å‰è¡¨
cross_tab = None  # æ›¿æ›ç‚ºæ‚¨çš„äº¤å‰è¡¨ä»£ç¢¼

# é¡¯ç¤ºçµæœ
print(cross_tab)

# %% [markdown]
# ### 3.3 ä½¿ç”¨ stack å’Œ unstack é‡å¡‘æ•¸æ“š
# 
# å°ç·´ç¿’ 3.1 ä¸­å‰µå»ºçš„æ¨ç´è¡¨:
# - ä½¿ç”¨ stack å°‡æœˆä»½å±¤ç´šè½‰ç‚ºè¡Œ
# - ç„¶å¾Œä½¿ç”¨ unstack å°‡è¨‚å–®ç‹€æ…‹è½‰ç‚ºåˆ—
# - æœ€å¾Œé‡ç½®ç´¢å¼•å¾—åˆ°ä¸€å€‹æ‰å¹³çš„è¡¨æ ¼

# %%
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ä»£ç¢¼
# ä½¿ç”¨ stack å’Œ unstack é‡å¡‘æ•¸æ“š
reshaped_data = None  # æ›¿æ›ç‚ºæ‚¨çš„é‡å¡‘ä»£ç¢¼

# é‡ç½®ç´¢å¼•
flat_data = None  # æ›¿æ›ç‚ºæ‚¨çš„é‡ç½®ç´¢å¼•ä»£ç¢¼

# é¡¯ç¤ºçµæœ
print(flat_data.head())

# %% [markdown]
# ## ğŸ”„ ç·´ç¿’ 4: æ•¸æ“šåˆä½µèˆ‡é€£æ¥
# 
# ä½¿ç”¨ M3.4 ä¸­å­¸åˆ°çš„æ•¸æ“šåˆä½µæŠ€è¡“å®Œæˆä»¥ä¸‹ä»»å‹™ã€‚

# %% [markdown]
# ### 4.1 å¤šè¡¨é€£æ¥å‰µå»ºå®Œæ•´è¦–åœ–
# 
# å‰µå»ºä¸€å€‹å®Œæ•´çš„è¨‚å–®è¦–åœ–ï¼ŒåŒ…å«:
# - è¨‚å–®ä¿¡æ¯
# - å®¢æˆ¶ä¿¡æ¯
# - ç”¢å“ä¿¡æ¯
# 
# ç¢ºä¿ä½¿ç”¨æ­£ç¢ºçš„é€£æ¥é¡å‹ï¼Œä¸¦è™•ç†å¯èƒ½çš„é‡è¤‡åˆ—åã€‚

# %%
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ä»£ç¢¼
# é€£æ¥è¨‚å–®å’Œå®¢æˆ¶
order_customer = None  # æ›¿æ›ç‚ºæ‚¨çš„åˆä½µä»£ç¢¼

# é€£æ¥è¨‚å–®å®¢æˆ¶å’Œç”¢å“
complete_view = None  # æ›¿æ›ç‚ºæ‚¨çš„åˆä½µä»£ç¢¼

# é¡¯ç¤ºçµæœ
print(f"å®Œæ•´è¦–åœ–çš„åˆ—: {complete_view.columns.tolist()}")
print(f"å®Œæ•´è¦–åœ–çš„è¡Œæ•¸: {len(complete_view)}")
print(complete_view.head())

# %% [markdown]
# ### 4.2 ä½¿ç”¨ä¸åŒçš„åˆä½µæ–¹æ³•æ¯”è¼ƒçµæœ
# 
# æ¯”è¼ƒä¸åŒåˆä½µæ–¹æ³• (inner, left, right, outer) åœ¨åˆä½µè¨‚å–®å’Œç”¢å“æ•¸æ“šæ™‚çš„çµæœå·®ç•°ã€‚
# 
# æç¤º: ç‚ºäº†å±•ç¤ºå·®ç•°ï¼Œå…ˆå‰µå»ºä¸€äº›æ²’æœ‰å°æ‡‰è¨‚å–®çš„ç”¢å“å’Œæ²’æœ‰å°æ‡‰ç”¢å“çš„è¨‚å–®ã€‚

# %%
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ä»£ç¢¼
# å‰µå»ºä¸€äº›æ²’æœ‰å°æ‡‰è¨‚å–®çš„ç”¢å“
missing_products = None  # æ›¿æ›ç‚ºæ‚¨çš„ä»£ç¢¼

# å‰µå»ºä¸€äº›æ²’æœ‰å°æ‡‰ç”¢å“çš„è¨‚å–®
missing_orders = None  # æ›¿æ›ç‚ºæ‚¨çš„ä»£ç¢¼

# æ¯”è¼ƒä¸åŒåˆä½µæ–¹æ³•
inner_join = None  # æ›¿æ›ç‚ºæ‚¨çš„å…§é€£æ¥ä»£ç¢¼
left_join = None  # æ›¿æ›ç‚ºæ‚¨çš„å·¦é€£æ¥ä»£ç¢¼
right_join = None  # æ›¿æ›ç‚ºæ‚¨çš„å³é€£æ¥ä»£ç¢¼
outer_join = None  # æ›¿æ›ç‚ºæ‚¨çš„å¤–é€£æ¥ä»£ç¢¼

# é¡¯ç¤ºçµæœæ¯”è¼ƒ
print(f"Inner Join è¡Œæ•¸: {len(inner_join)}")
print(f"Left Join è¡Œæ•¸: {len(left_join)}")
print(f"Right Join è¡Œæ•¸: {len(right_join)}")
print(f"Outer Join è¡Œæ•¸: {len(outer_join)}")

# %% [markdown]
# ### 4.3 æ¢ä»¶å¼åˆä½µ
# 
# å‡è¨­æˆ‘å€‘æœ‰ä¸€å€‹æŠ˜æ‰£è¡¨ï¼Œæ ¹æ“šè¨‚å–®æ—¥æœŸå’Œç”¢å“é¡åˆ¥æä¾›ä¸åŒçš„æŠ˜æ‰£ç‡ã€‚ä½¿ç”¨æ¢ä»¶å¼åˆä½µå°‡é©ç•¶çš„æŠ˜æ‰£æ‡‰ç”¨åˆ°æ¯å€‹è¨‚å–®ã€‚

# %%
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ä»£ç¢¼
# å‰µå»ºæŠ˜æ‰£è¡¨
discount_data = {
    'category': ['Electronics', 'Electronics', 'Clothing', 'Clothing', 'Home', 'Home', 'Books', 'Sports'],
    'start_date': pd.to_datetime(['2022-01-01', '2022-07-01', '2022-01-01', '2022-07-01', 
                                  '2022-01-01', '2022-07-01', '2022-01-01', '2022-01-01']),
    'end_date': pd.to_datetime(['2022-06-30', '2022-12-31', '2022-06-30', '2022-12-31', 
                                '2022-06-30', '2022-12-31', '2022-12-31', '2022-12-31']),
    'discount_rate': [0.05, 0.08, 0.10, 0.15, 0.07, 0.12, 0.20, 0.10]
}
discount_df = pd.DataFrame(discount_data)

# æº–å‚™è¨‚å–®å’Œç”¢å“æ•¸æ“š
merged_data = None  # æ›¿æ›ç‚ºæ‚¨çš„åˆä½µä»£ç¢¼

# æ¢ä»¶å¼åˆä½µæ‡‰ç”¨æŠ˜æ‰£
# æç¤º: æ‚¨éœ€è¦æª¢æŸ¥æ¯å€‹è¨‚å–®çš„æ—¥æœŸæ˜¯å¦åœ¨æŠ˜æ‰£çš„æ—¥æœŸç¯„åœå…§ï¼Œä»¥åŠç”¢å“é¡åˆ¥æ˜¯å¦åŒ¹é…
orders_with_discount = None  # æ›¿æ›ç‚ºæ‚¨çš„æ¢ä»¶å¼åˆä½µä»£ç¢¼

# è¨ˆç®—æŠ˜æ‰£å¾Œé‡‘é¡
orders_with_discount['discounted_amount'] = None  # æ›¿æ›ç‚ºæ‚¨çš„è¨ˆç®—ä»£ç¢¼

# é¡¯ç¤ºçµæœ
print(orders_with_discount[['order_id', 'order_date', 'category', 'total_amount', 'discount_rate', 'discounted_amount']].head(10))

# %% [markdown]
# ## â° ç·´ç¿’ 5: æ™‚é–“åºåˆ—åˆ†æ
# 
# ä½¿ç”¨ M3.5 ä¸­å­¸åˆ°çš„æ™‚é–“åºåˆ—åˆ†ææŠ€è¡“å®Œæˆä»¥ä¸‹ä»»å‹™ã€‚

# %% [markdown]
# ### 5.1 æ™‚é–“åºåˆ—é‡æ¡æ¨£èˆ‡é »ç‡è½‰æ›
# 
# å°è¨‚å–®æ•¸æ“š:
# - æŒ‰æ—¥ã€é€±ã€æœˆé‡æ¡æ¨£ï¼Œè¨ˆç®—æ¯å€‹æ™‚é–“å–®ä½çš„è¨‚å–®æ•¸å’Œç¸½é‡‘é¡
# - æ¯”è¼ƒä¸åŒæ™‚é–“å°ºåº¦ä¸‹çš„è¶¨å‹¢
# - ä½¿ç”¨é©ç•¶çš„è¦–è¦ºåŒ–å±•ç¤ºçµæœ

# %%
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ä»£ç¢¼
# è¨­ç½®è¨‚å–®æ—¥æœŸç‚ºç´¢å¼•
orders_ts = None  # æ›¿æ›ç‚ºæ‚¨çš„ä»£ç¢¼

# æŒ‰ä¸åŒé »ç‡é‡æ¡æ¨£
daily_orders = None  # æ›¿æ›ç‚ºæ‚¨çš„æ—¥é‡æ¡æ¨£ä»£ç¢¼
weekly_orders = None  # æ›¿æ›ç‚ºæ‚¨çš„é€±é‡æ¡æ¨£ä»£ç¢¼
monthly_orders = None  # æ›¿æ›ç‚ºæ‚¨çš„æœˆé‡æ¡æ¨£ä»£ç¢¼

# è¦–è¦ºåŒ–æ¯”è¼ƒ
plt.figure(figsize=(15, 10))

# ç¹ªè£½æ—¥è¨‚å–®é‡
plt.subplot(3, 1, 1)
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ç¹ªåœ–ä»£ç¢¼

# ç¹ªè£½é€±è¨‚å–®é‡
plt.subplot(3, 1, 2)
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ç¹ªåœ–ä»£ç¢¼

# ç¹ªè£½æœˆè¨‚å–®é‡
plt.subplot(3, 1, 3)
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ç¹ªåœ–ä»£ç¢¼

plt.tight_layout()
plt.show()

# %% [markdown]
# ### 5.2 ç§»å‹•çª—å£è¨ˆç®—
# 
# è¨ˆç®—è¨‚å–®é‡‘é¡çš„:
# - 7å¤©ç§»å‹•å¹³å‡
# - 30å¤©ç§»å‹•å¹³å‡
# - 7å¤©ç§»å‹•æ¨™æº–å·®
# 
# ä½¿ç”¨é€™äº›æŒ‡æ¨™è­˜åˆ¥éŠ·å”®è¶¨å‹¢å’Œæ³¢å‹•æ€§ã€‚

# %%
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ä»£ç¢¼
# æŒ‰æ—¥æœŸåŒ¯ç¸½è¨‚å–®é‡‘é¡
daily_sales = None  # æ›¿æ›ç‚ºæ‚¨çš„ä»£ç¢¼

# è¨ˆç®—ç§»å‹•å¹³å‡å’Œæ¨™æº–å·®
daily_sales['7d_MA'] = None  # æ›¿æ›ç‚ºæ‚¨çš„7å¤©ç§»å‹•å¹³å‡ä»£ç¢¼
daily_sales['30d_MA'] = None  # æ›¿æ›ç‚ºæ‚¨çš„30å¤©ç§»å‹•å¹³å‡ä»£ç¢¼
daily_sales['7d_STD'] = None  # æ›¿æ›ç‚ºæ‚¨çš„7å¤©æ¨™æº–å·®ä»£ç¢¼

# è¦–è¦ºåŒ–çµæœ
plt.figure(figsize=(15, 10))

# ç¹ªè£½ç§»å‹•å¹³å‡
plt.subplot(2, 1, 1)
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ç¹ªåœ–ä»£ç¢¼

# ç¹ªè£½ç§»å‹•æ¨™æº–å·®
plt.subplot(2, 1, 2)
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ç¹ªåœ–ä»£ç¢¼

plt.tight_layout()
plt.show()

# %% [markdown]
# ### 5.3 æ™‚é–“åºåˆ—åˆ†è§£
# 
# å°æœˆåº¦éŠ·å”®æ•¸æ“šé€²è¡Œæ™‚é–“åºåˆ—åˆ†è§£:
# - æå–è¶¨å‹¢æˆåˆ†
# - æå–å­£ç¯€æ€§æˆåˆ†
# - æå–æ®˜å·®æˆåˆ†
# - åˆ†æå„æˆåˆ†çš„ç‰¹é»

# %%
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ä»£ç¢¼
from statsmodels.tsa.seasonal import seasonal_decompose

# æº–å‚™æœˆåº¦éŠ·å”®æ•¸æ“š
monthly_sales = None  # æ›¿æ›ç‚ºæ‚¨çš„ä»£ç¢¼

# é€²è¡Œæ™‚é–“åºåˆ—åˆ†è§£
decomposition = None  # æ›¿æ›ç‚ºæ‚¨çš„åˆ†è§£ä»£ç¢¼

# æå–å„æˆåˆ†
trend = decomposition.trend
seasonal = decomposition.seasonal
residual = decomposition.resid

# è¦–è¦ºåŒ–åˆ†è§£çµæœ
plt.figure(figsize=(12, 10))

# ç¹ªè£½åŸå§‹æ•¸æ“š
plt.subplot(4, 1, 1)
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ç¹ªåœ–ä»£ç¢¼

# ç¹ªè£½è¶¨å‹¢æˆåˆ†
plt.subplot(4, 1, 2)
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ç¹ªåœ–ä»£ç¢¼

# ç¹ªè£½å­£ç¯€æ€§æˆåˆ†
plt.subplot(4, 1, 3)
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ç¹ªåœ–ä»£ç¢¼

# ç¹ªè£½æ®˜å·®æˆåˆ†
plt.subplot(4, 1, 4)
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ç¹ªåœ–ä»£ç¢¼

plt.tight_layout()
plt.show()

# %% [markdown]
# ## ğŸ† ç¶œåˆæŒ‘æˆ°: é›»å­å•†å‹™æ•¸æ“šåˆ†æå„€è¡¨æ¿
# 
# çµåˆæœ¬æ¨¡çµ„å­¸åˆ°çš„æ‰€æœ‰æŠ€è¡“ï¼Œå‰µå»ºä¸€å€‹é›»å­å•†å‹™æ•¸æ“šåˆ†æå„€è¡¨æ¿ï¼ŒåŒ…æ‹¬:
# 
# 1. éŠ·å”®æ¦‚æ³: ç¸½è¨‚å–®æ•¸ã€ç¸½éŠ·å”®é¡ã€å¹³å‡è¨‚å–®é‡‘é¡ã€å–æ¶ˆç‡
# 2. æ™‚é–“è¶¨å‹¢: æŒ‰æœˆéŠ·å”®è¶¨å‹¢ï¼Œè­˜åˆ¥å­£ç¯€æ€§æ¨¡å¼
# 3. å®¢æˆ¶åˆ†æ: æŒ‰å®¢æˆ¶ç´°åˆ†çš„éŠ·å”®åˆ†å¸ƒï¼Œè­˜åˆ¥é«˜åƒ¹å€¼å®¢æˆ¶
# 4. ç”¢å“åˆ†æ: æŒ‰é¡åˆ¥çš„éŠ·å”®åˆ†å¸ƒï¼Œè­˜åˆ¥ç†±é–€ç”¢å“
# 5. åœ°ç†åˆ†æ: æŒ‰åœ‹å®¶çš„éŠ·å”®åˆ†å¸ƒ
# 
# ä½¿ç”¨é©ç•¶çš„è¦–è¦ºåŒ–å±•ç¤ºæ‚¨çš„åˆ†æçµæœã€‚

# %%
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ç¶œåˆåˆ†æä»£ç¢¼
# 1. æº–å‚™æ•¸æ“š
complete_data = None  # æ›¿æ›ç‚ºæ‚¨çš„æ•¸æ“šæº–å‚™ä»£ç¢¼

# 2. éŠ·å”®æ¦‚æ³
sales_summary = None  # æ›¿æ›ç‚ºæ‚¨çš„éŠ·å”®æ¦‚æ³è¨ˆç®—ä»£ç¢¼

# 3. æ™‚é–“è¶¨å‹¢åˆ†æ
time_trend = None  # æ›¿æ›ç‚ºæ‚¨çš„æ™‚é–“è¶¨å‹¢åˆ†æä»£ç¢¼

# 4. å®¢æˆ¶åˆ†æ
customer_analysis = None  # æ›¿æ›ç‚ºæ‚¨çš„å®¢æˆ¶åˆ†æä»£ç¢¼

# 5. ç”¢å“åˆ†æ
product_analysis = None  # æ›¿æ›ç‚ºæ‚¨çš„ç”¢å“åˆ†æä»£ç¢¼

# 6. åœ°ç†åˆ†æ
geo_analysis = None  # æ›¿æ›ç‚ºæ‚¨çš„åœ°ç†åˆ†æä»£ç¢¼

# 7. å‰µå»ºå„€è¡¨æ¿
plt.figure(figsize=(15, 15))

# éŠ·å”®è¶¨å‹¢
plt.subplot(3, 2, 1)
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ç¹ªåœ–ä»£ç¢¼

# é¡åˆ¥åˆ†å¸ƒ
plt.subplot(3, 2, 2)
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ç¹ªåœ–ä»£ç¢¼

# å®¢æˆ¶ç´°åˆ†
plt.subplot(3, 2, 3)
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ç¹ªåœ–ä»£ç¢¼

# æ”¯ä»˜æ–¹å¼åˆ†å¸ƒ
plt.subplot(3, 2, 4)
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ç¹ªåœ–ä»£ç¢¼

# åœ‹å®¶åˆ†å¸ƒ
plt.subplot(3, 2, 5)
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ç¹ªåœ–ä»£ç¢¼

# è¨‚å–®ç‹€æ…‹åˆ†å¸ƒ
plt.subplot(3, 2, 6)
# åœ¨æ­¤ç·¨å¯«æ‚¨çš„ç¹ªåœ–ä»£ç¢¼

plt.tight_layout()
plt.show()

# %% [markdown]
# ## ğŸ“‹ ç¸½çµ
# 
# åœ¨é€™å€‹ç·´ç¿’ä¸­ï¼Œæ‚¨æ‡‰ç”¨äº† Pandas é€²éšæ¨¡çµ„ä¸­å­¸åˆ°çš„å„ç¨®æŠ€è¡“ï¼ŒåŒ…æ‹¬:
# 
# - é€²éšæ¢ä»¶ç¯©é¸
# - åˆ†çµ„èˆ‡èšåˆ
# - æ¨ç´è¡¨èˆ‡äº¤å‰è¡¨
# - æ•¸æ“šåˆä½µèˆ‡é€£æ¥
# - æ™‚é–“åºåˆ—åˆ†æ
# 
# é€™äº›æŠ€èƒ½å°æ–¼è™•ç†è¤‡é›œçš„æ•¸æ“šåˆ†æä»»å‹™éå¸¸é‡è¦ï¼Œèƒ½å¤ å¹«åŠ©æ‚¨å¾æ•¸æ“šä¸­æå–æœ‰åƒ¹å€¼çš„è¦‹è§£ã€‚ 